<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revia - Code Field</title>
    <!-- Favicon -->
    <link rel="icon" href="favicon256x256.ico" sizes="256x256" type="image/x-icon">
    <link rel="icon" href="favicon512x512.ico" sizes="512x512" type="image/x-icon">
    <link rel="icon" href="favicon1024x1024.ico" sizes="1024x1024" type="image/x-icon">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Montserrat font (ana içerik için) -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <!-- Metamorphous font (menü için) -->
    <link href="https://fonts.googleapis.com/css2?family=Metamorphous&display=swap" rel="stylesheet">
    <!-- JSZip CDN for creating ZIP files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <!-- FileSaver.js CDN for saving files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }
        /* Menü fontu için özel stil */
        .menu-font {
            font-family: 'Metamorphous', cursive;
        }
        /* Textarea'nın alanı doldurmasını sağlamak için temel stil */
        textarea {
            display: block; /* Tam genişliği almasını sağlar */
            /* Syntax highlighting için temel stil */
            background-color: #ffffff; /* Beyaz arka plan */
            color: #000000; /* Siyah metin rengi */
            font-family: 'Consolas', 'Monaco', 'Andale Mono', 'Ubuntu Mono', monospace; /* Monospaced font */
            line-height: 1.5; /* Satır aralığı */
            padding-left: 10px; /* Satır numaraları ile metin arasında boşluk */
        }

        /* Editor container for line numbers and textarea */
        .editor-container {
            display: flex;
            flex-grow: 1;
            border: 1px solid #3e4451; /* Koyu kenarlık */
            border-radius: 0.375rem; /* rounded-md */
            overflow: hidden; /* İçerik taşmasını engelle */
        }

        /* Line numbers styling */
        .line-numbers {
            width: 40px; /* Sabit genişlik */
            background-color: #ffffff; /* Beyaz arka plan */
            color: #000000; /* Siyah satır numaraları */
            padding: 1rem 0.5rem; /* Padding */
            text-align: right;
            font-family: 'Consolas', 'Monaco', 'Andale Mono', 'Ubuntu Mono', monospace;
            font-size: 0.875rem; /* text-sm */
            line-height: 1.5;
            flex-shrink: 0; /* Küçülmesini engelle */
            overflow: hidden; /* Metin taşmasını engelle */
            user-select: none; /* Seçilemez yap */
        }
        .line-numbers div {
            height: 1.5em; /* Match textarea line-height */
        }

        /* Drag over effect for folders and root area */
        .drag-over-target {
            background-color: #8C4D2D !important; /* Darker shade for visual feedback */
        }
        /* Custom Notification */
        #customNotification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px 30px;
            border-radius: 8px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none; /* Allows clicks to pass through */
        }
        #customNotification.show {
            opacity: 1;
        }
        /* Style for pre/code display in simulation */
        #simulationContainer pre {
            white-space: pre-wrap; /* Ensures long lines wrap */
            word-wrap: break-word; /* Breaks words if necessary */
            max-height: 100%; /* Ensures it doesn't overflow */
        }
    </style>
    <script>
        // Varsayılan başlangıç dosyaları
        const DEFAULT_FILES = [
            { id: '1', name: 'note.txt', content: `Merhaba, bu sizin not dosyanız.`, parentId: null, isFolder: false, type: 'text' },
            { id: '2', name: 'index.html', content: `<!DOCTYPE html>\\n<html lang=\\"en\\">\\n<head>\\n    <meta charset=\\"UTF-8\\">\\n    <meta name=\\"viewport\\" content=\\"width=device-width, initial-scale=1.0\\">\\n    <title>Merhaba HTML</title>\\n    <style>\\n        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f0f0; }\\n        h1 { color: #333; }\\n    </style>\\n</head>\\n<body>\\n    <h1>Merhaba Dünya!</h1>\\n</body>\\n</html>`, parentId: null, isFolder: false, type: 'html' },
        ];

        let files = []; // Başlangıçta boş, localStorage'dan yüklenecek veya varsayılanlar kullanılacak
        let selectedFileId = null;
        let nextFileId = 1;

        // History for Undo/Redo
        let undoStack = [];
        let redoStack = [];
        const MAX_HISTORY_SIZE = 100; // Limit history size to prevent excessive memory usage

        // DOM elementleri
        let fileListElement;
        let fileContentElement;
        let selectedFileNameElement;
        let folderContentDisplayElement;
        let folderChildrenListElement;
        let mediaPlayerDisplayElement; // New element for media player
        let customNotificationElement; // Custom notification element
        let simulationContainerElement; // New element for simulation output
        let lineNumbersElement; // New element for line numbers

        let addFileBtn;
        let addFolderBtn;
        let deleteFileBtn;
        let clearFileContentBtn;
        let saveFileBtn;
        let saveAsFileBtn;
        let saveProjectBtn;
        let renameFileBtn;
        let resetProjectBtn; // Yeni buton
        let importFileBtn; // İçe Aktar butonu
        let importFileInput; // Gizli input

        let runCodeBtn;
        let undoBtn;
        let redoBtn;

        // Modallar
        let saveAsModal;
        let closeSaveAsModalBtn;
        let saveAsFileNameInput;
        let confirmSaveAsBtn;
        let cancelSaveAsBtn;

        let renameModal;
        let closeRenameModalBtn;
        let newFileNameInputModal;
        let confirmRenameBtn;
        let cancelRenameBtn;

        let confirmationModal;
        let confirmationModalTitle;
        let confirmationModalMessage;
        let confirmActionBtn;
        let cancelActionBtn;

        let currentConfirmationCallback = null; // Onay modalı için callback

        // Özel bildirim fonksiyonu
        function showNotification(message, duration = 2000) {
            if (!customNotificationElement) return;
            customNotificationElement.textContent = message;
            customNotificationElement.classList.add('show');
            setTimeout(() => {
                customNotificationElement.classList.remove('show');
            }, duration);
        }

        // Özel onay modalını gösteren fonksiyon
        function showConfirmationModal(title, message, onConfirm) {
            confirmationModalTitle.textContent = title;
            confirmationModalMessage.textContent = message;
            confirmationModal.classList.remove('hidden');
            currentConfirmationCallback = onConfirm;
        }

        // Özel onay modalını gizleyen fonksiyon
        function hideConfirmationModal() {
            confirmationModal.classList.add('hidden');
            currentConfirmationCallback = null;
        }

        // Helper function to build a hierarchical tree from the flat files array
        function buildFileTree(files, parentId = null) {
            const children = files.filter(file => file.parentId === parentId)
                .sort((a, b) => { // Sort folders before files, then alphabetically
                    if (a.isFolder && !b.isFolder) return -1;
                    if (!a.isFolder && b.isFolder) return 1;
                    return a.name.localeCompare(b.name);
                });

            return children.map(file => ({
                ...file,
                children: file.isFolder ? buildFileTree(files, file.id) : []
            }));
        }

        // Helper function to render the hierarchical tree into HTML
        function renderTree(tree, level = 0) {
            let html = '';
            tree.forEach(file => {
                html += `<li
                    id="file-${file.id}"
                    class="p-2 cursor-pointer rounded-md mb-1 transition duration-200 ${selectedFileId === file.id ? 'bg-[#9C4D2D] font-semibold' : 'hover:bg-[#8C4D2D]'} ${level > 0 ? 'ml-4' : ''}"
                    draggable="true"
                    data-file-id="${file.id}"
                    data-is-folder="${file.isFolder}"
                >
                    ${file.isFolder ? `
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 inline-block align-middle mr-1">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <path d="M3 8.2C3 7.07989 3 6.51984 3.21799 6.09202C3.40973 5.71569 3.71569 5.40973 4.09202 5.21799C4.51984 5 5.0799 5 6.2 5H9.67452C10.1637 5 10.4083 5 10.6385 5.05526C10.8425 5.10425 11.0376 5.18506 11.2166 5.29472C11.4184 5.4184 11.5914 5.59135 11.9373 5.93726L12.0627 6.06274C12.4086 6.40865 12.5816 6.5816 12.7834 6.70528C12.9624 6.81494 13.1575 6.89575 13.3615 6.94474C13.5917 7 13.8363 7 14.3255 7H17.8C18.9201 7 19.4802 7 19.908 7.21799C20.2843 7.40973 20.5903 7.71569 20.782 8.09202C21 8.51984 21 9.0799 21 10.2V15.8C21 16.9201 21 17.4802 20.782 17.908C20.5903 18.2843 20.2843 18.5903 19.908 18.782C19.4802 19 18.9201 19 17.8 19H6.2C5.07989 19 4.51984 19 4.09202 18.782C3.71569 18.5903 3.40973 18.2843 3.21799 17.908C3 17.4802 3 16.9201 3 15.8V8.2Z" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </g>
                        </svg>
                    ` : `
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 inline-block align-middle mr-1">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <path d="M9 17H15M9 13H15M9 9H10M13 3H8.2C7.0799 3 6.51984 3 6.09202 3.21799C5.71569 3.40973 5.40973 3.71569 5.21799 4.09202C5 4.51984 5 5.0799 5 6.2V17.8C5 18.9201 5 19.4802 5.21799 19.908C5.40973 20.2843 5.71569 20.5903 6.09202 20.782C6.51984 21 7.0799 21 8.2 21H15.8C16.9201 21 17.4802 21 17.908 20.782C18.2843 20.5903 18.5903 20.2843 18.782 19.908C19 19.4802 19 18.9201 19 17.8V9M13 3L19 9M13 3V7.4C13 7.96005 13 8.24008 13.109 8.45399C13.2049 8.64215 13.3578 8.79513 13.546 8.89101C13.7599 9 14.0399 9 14.6 9H19" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </g>
                        </svg>
                    `} ${file.name}
                </li>`;
                if (file.children.length > 0) {
                    html += `<ul class="pl-4">`; // Indent children
                    html += renderTree(file.children, level + 1);
                    html += `</ul>`;
                }
                html += `</li>`;
            });
            return html;
        }

        // Dosya listesini render eden fonksiyon
        function renderFiles() {
            if (!fileListElement) return;
            fileListElement.innerHTML = '';
            const fileTree = buildFileTree(files);
            fileListElement.innerHTML = renderTree(fileTree);

            // Add click event listeners to new list items (delegated)
            fileListElement.querySelectorAll('li').forEach(listItem => {
                listItem.addEventListener('click', (e) => {
                    e.stopPropagation(); // CRITICAL: Stop event bubbling
                    const clickedItem = e.currentTarget;
                    const fileId = clickedItem.dataset.fileId;
                    selectFile(fileId);
                });
            });
        }

        // Seçili dosyaya göre düzenleyici alanını render eden fonksiyon
        function renderEditor() {
            if (!fileContentElement || !selectedFileNameElement || !folderContentDisplayElement || !folderChildrenListElement || !mediaPlayerDisplayElement || !simulationContainerElement || !lineNumbersElement) {
                console.error("renderEditor: Gerekli DOM elementlerinden biri veya birkaçı bulunamadı!");
                return;
            }

            const selectedFile = files.find(file => file.id === selectedFileId);

            // Hide all display areas initially
            fileContentElement.parentElement.classList.add('hidden'); // Hide editor container
            folderContentDisplayElement.classList.add('hidden');
            mediaPlayerDisplayElement.classList.add('hidden');
            simulationContainerElement.classList.add('hidden'); // Hide simulation container

            if (selectedFile) {
                selectedFileNameElement.textContent = selectedFile.name;

                if (selectedFile.isFolder) {
                    folderContentDisplayElement.classList.remove('hidden');

                    const folderChildren = files.filter(f => f.parentId === selectedFile.id);
                    if (folderChildrenListElement) {
                        folderChildrenListElement.innerHTML = '';
                        if (folderChildren.length > 0) {
                            folderChildren.forEach(child => {
                                const li = document.createElement('li');
                                li.className = 'p-1 cursor-pointer hover:bg-gray-200 rounded-md';
                                li.dataset.fileId = child.id;
                                li.dataset.isFolder = child.isFolder;
                                li.innerHTML = `${child.isFolder ? `
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 inline-block align-middle mr-1">
                                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                        <g id="SVGRepo_iconCarrier">
                                            <path d="M3 8.2C3 7.07989 3 6.51984 3.21799 6.09202C3.40973 5.71569 3.71569 5.40973 4.09202 5.21799C4.51984 5 5.0799 5 6.2 5H9.67452C10.1637 5 10.4083 5 10.6385 5.05526C10.8425 5.10425 11.0376 5.18506 11.2166 5.29472C11.4184 5.4184 11.5914 5.59135 11.9373 5.93726L12.0627 6.06274C12.4086 6.40865 12.5816 6.5816 12.7834 6.70528C12.9624 6.81494 13.1575 6.89575 13.3615 6.94474C13.5917 7 13.8363 7 14.3255 7H17.8C18.9201 7 19.4802 7 19.908 7.21799C20.2843 7.40973 20.5903 7.71569 20.782 8.09202C21 8.51984 21 9.0799 21 10.2V15.8C21 16.9201 21 17.4802 20.782 17.908C20.5903 18.2843 20.2843 18.5903 19.908 18.782C19.4802 19 18.9201 19 17.8 19H6.2C5.07989 19 4.51984 19 4.09202 18.782C3.71569 18.5903 3.40973 18.2843 3.21799 17.908C3 17.4802 3 16.9201 3 15.8V8.2Z" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                        </g>
                                    </svg>
                                ` : `
                                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 inline-block align-middle mr-1">
                                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                        <g id="SVGRepo_iconCarrier">
                                            <path d="M9 17H15M9 13H15M9 9H10M13 3H8.2C7.0799 3 6.51984 3 6.09202 3.21799C5.71569 3.40973 5.40973 3.71569 5.21799 4.09202C5 4.51984 5 5.0799 5 6.2V17.8C5 18.9201 5 19.4802 5.21799 19.908C5.40973 20.2843 5.71569 20.5903 6.09202 20.782C6.51984 21 7.0799 21 8.2 21H15.8C16.9201 21 17.4802 21 17.908 20.782C18.2843 20.5903 18.5903 20.2843 18.782 19.908C19 19.4802 19 18.9201 19 17.8V9M13 3L19 9M13 3V7.4C13 7.96005 13 8.24008 13.109 8.45399C13.2049 8.64215 13.3578 8.79513 13.546 8.89101C13.7599 9 14.0399 9 14.6 9H19" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                        </g>
                                    </svg>
                                `} ${child.name}`;
                                
                                li.addEventListener('click', (e) => {
                                    e.stopPropagation();
                                    const clickedChildId = e.currentTarget.dataset.fileId;
                                    selectFile(clickedChildId);
                                });
                                folderChildrenListElement.appendChild(li);
                            });
                        } else {
                            folderChildrenListElement.innerHTML = '<li class="text-gray-500">Bu klasör boş.</li>';
                        }
                    } else {
                        console.error("folderChildrenList elementi bulunamadı.");
                    }

                } else if (selectedFile.type === 'audio' || selectedFile.type === 'video' || selectedFile.type === 'image') {
                    mediaPlayerDisplayElement.classList.remove('hidden');
                }
                else { // Regular text/code file
                    fileContentElement.parentElement.classList.remove('hidden'); // Show editor container
                    fileContentElement.value = selectedFile.content;
                    updateLineNumbers(); // Update line numbers when content changes
                }
            } else {
                selectedFileNameElement.textContent = 'Dosya Seçilmedi';
                fileContentElement.parentElement.classList.remove('hidden'); // Show editor container
                fileContentElement.value = '';
                updateLineNumbers(); // Update line numbers for empty content
            }
        }

        // Dosyaları localStorage'a kaydet
        function saveFilesToLocalStorage() {
            localStorage.setItem('renpyFiles', JSON.stringify(files));
            localStorage.setItem('renpySelectedFileId', selectedFileId);
            localStorage.setItem('renpyNextFileId', nextFileId);
            localStorage.setItem('renpyUndoStack', JSON.stringify(undoStack));
            localStorage.setItem('renpyRedoStack', JSON.stringify(redoStack));
        }

        // Dosyaları localStorage'dan yükle
        function loadFilesFromLocalStorage() {
            const storedFiles = localStorage.getItem('renpyFiles');
            const storedSelectedFileId = localStorage.getItem('renpySelectedFileId');
            const storedNextFileId = localStorage.getItem('renpyNextFileId');
            const storedUndoStack = localStorage.getItem('renpyUndoStack');
            const storedRedoStack = localStorage.getItem('renpyRedoStack');

            if (storedFiles) {
                try {
                    const parsedFiles = JSON.parse(storedFiles);
                    files = parsedFiles.map(f => ({ ...f, isFolder: f.isFolder === true || f.isFolder === 'true' }));
                    nextFileId = storedNextFileId ? parseInt(storedNextFileId) : (files.length > 0 ? Math.max(...files.map(f => parseInt(f.id))) + 1 : 1);
                    selectedFileId = storedSelectedFileId && files.some(f => f.id === storedSelectedFileId) ? storedSelectedFileId : (files[0]?.id || null);
                    undoStack = storedUndoStack ? JSON.parse(storedUndoStack) : [];
                    redoStack = storedRedoStack ? JSON.parse(storedRedoStack) : [];

                    console.log("Files loaded from localStorage.");
                } catch (e) {
                    console.error("Error parsing files from localStorage, using default. Error:", e);
                    resetToDefaultFiles();
                }
            } else {
                console.log("No files found in localStorage, using default files.");
                resetToDefaultFiles();
            }
        }

        // Projeyi varsayılan dosyalara sıfırla
        function resetToDefaultFiles() {
            files = JSON.parse(JSON.stringify(DEFAULT_FILES)); // Deep copy
            files.sort((a, b) => {
                if (a.parentId === null && b.parentId !== null) return -1;
                if (a.parentId !== null && b.parentId === null) return 1;
                if (a.parentId !== null && b.parentId !== null && a.parentId !== b.parentId) {
                    return a.parentId.localeCompare(b.parentId);
                }
                if (a.isFolder && !b.isFolder) return -1;
                if (!a.isFolder && b.isFolder) return 1;
                return a.name.localeCompare(b.name);
            });
            selectedFileId = files.find(f => f.name === 'note.txt')?.id || files[0]?.id || null;
            nextFileId = files.length > 0 ? Math.max(...files.map(f => parseInt(f.id))) + 1 : 1;
            undoStack = [];
            redoStack = [];
            if (selectedFileId) {
                undoStack.push(files.find(f => f.id === selectedFileId)?.content || '');
            }
            saveFilesToLocalStorage();
            renderFiles();
            renderEditor();
        }

        // --- Ana Fonksiyonlar ---

        function addFile(fileName = null, content = null, type = 'text', parentId = null) {
            const newFileName = fileName || `new_file_${nextFileId}`; // Uzantısız olarak oluştur
            const newFileContent = content || ''; // İçeriği boş bırak
            const newFile = {
                id: String(nextFileId),
                name: newFileName,
                content: newFileContent,
                parentId: parentId !== null ? parentId : (selectedFileId && files.find(f => f.id === selectedFileId)?.isFolder ? selectedFileId : null),
                isFolder: false,
                type: type // Set file type
            };
            files.push(newFile);
            files.sort((a, b) => {
                if (a.parentId === null && b.parentId !== null) return -1;
                if (a.parentId !== null && b.parentId === null) return 1;
                if (a.parentId !== null && b.parentId !== null && a.parentId !== b.parentId) {
                    return a.parentId.localeCompare(b.parentId);
                }
                if (a.isFolder && !b.isFolder) return -1;
                if (!a.isFolder && b.isFolder) return 1;
                return a.name.localeCompare(b.name);
            });
            selectedFileId = newFile.id;
            nextFileId++;
            renderFiles();
            renderEditor();
            saveFilesToLocalStorage(); // Save after adding file
            return newFile;
        }

        function addFolder(folderName = null, parentId = null) {
            const newFolderName = folderName || `new_folder_${nextFileId}`;
            const newFolder = {
                id: String(nextFileId),
                name: newFolderName,
                content: '',
                isFolder: true,
                parentId: parentId !== null ? parentId : (selectedFileId && files.find(f => f.id === selectedFileId)?.isFolder ? selectedFileId : null),
                type: 'folder'
            };
            files.push(newFolder);
            files.sort((a, b) => {
                if (a.parentId === null && b.parentId !== null) return -1;
                if (a.parentId !== null && b.parentId === null) return 1;
                if (a.parentId !== null && b.parentId !== null && a.parentId !== b.parentId) {
                    return a.parentId.localeCompare(b.parentId);
                }
                if (a.isFolder && !b.isFolder) return -1;
                if (!a.isFolder && b.isFolder) return 1;
                return a.name.localeCompare(b.name);
            });
            nextFileId++;
            renderFiles();
            renderEditor();
            saveFilesToLocalStorage(); // Save after adding folder
            return newFolder;
        }

        function deleteFile() {
            if (!selectedFileId) {
                showNotification("Lütfen silmek için bir dosya seçin.");
                return;
            }

            const selectedFile = files.find(f => f.id === selectedFileId);
            showConfirmationModal("Dosyayı Sil", `"${selectedFile.name}" dosyasını silmek istediğinizden emin misiniz?`, () => {
                files = files.filter(file => file.id !== selectedFileId && file.parentId !== selectedFileId);
                files.sort((a, b) => {
                    if (a.parentId === null && b.parentId !== null) return -1;
                    if (a.parentId !== null && b.parentId === null) return 1;
                    if (a.parentId !== null && b.parentId !== null && a.parentId !== b.parentId) {
                        return a.parentId.localeCompare(b.parentId);
                    }
                    if (a.isFolder && !b.isFolder) return -1;
                    if (!a.isFolder && b.isFolder) return 1;
                    return a.name.localeCompare(b.name);
                });
                selectedFileId = files[0]?.id || null;
                renderFiles();
                renderEditor();
                saveFilesToLocalStorage(); // Save after deleting file
                hideConfirmationModal();
                showNotification("Dosya başarıyla silindi.");
            });
        }

        function clearFileContent() {
            if (!selectedFileId) {
                showNotification("Lütfen içeriğini temizlemek için bir dosya seçin.");
                return;
            }
            const selectedFile = files.find(f => f.id === selectedFileId);
            if (selectedFile && !selectedFile.isFolder && selectedFile.type === 'text') {
                showConfirmationModal("İçeriği Temizle", `"${selectedFile.name}" dosyasının içeriğini tamamen silmek istediğinizden emin misiniz? Bu işlem geri alınamaz.`, () => {
                    updateFileContent('');
                    saveFilesToLocalStorage(); // Save after clearing content
                    hideConfirmationModal();
                    showNotification("Dosya içeriği temizlendi.");
                });
            } else {
                showNotification("Seçili öğe bir dosya değil, bir klasör veya metin tabanlı olmayan bir dosya. İçeriği temizlenemez.");
            }
        }

        // Saves the current content of the editor to the undo stack.
        function saveState() {
            const currentContent = fileContentElement.value;
            if (undoStack.length === 0 || undoStack[undoStack.length - 1] !== currentContent) {
                undoStack.push(currentContent);
                if (undoStack.length > MAX_HISTORY_SIZE) {
                    undoStack.shift();
                }
                redoStack = [];
                saveFilesToLocalStorage(); // Save state to local storage
            }
        }

        // Applies a given content state to the editor.
        function applyState(content) {
            fileContentElement.value = content;
            updateFileContent(content, false); // Don't save to history again
            saveFilesToLocalStorage(); // Save state to local storage
        }

        function selectFile(id) {
            selectedFileId = id;
            const fileForCheck = files.find(f => f.id === selectedFileId);

            renderFiles();
            renderEditor();

            undoStack = [];
            redoStack = [];
            if (fileForCheck && !fileForCheck.isFolder && fileForCheck.type === 'text') {
                undoStack.push(fileForCheck.content);
            } else {
                undoStack.push('');
            }
            saveFilesToLocalStorage(); // Save selected file and history state
        }

        // Updates the content of the currently selected file.
        // `saveToHistory` parameter controls whether this change should be added to the undo stack.
        function updateFileContent(content, saveToHistory = true) {
            files = files.map(file =>
                file.id === selectedFileId ? { ...file, content } : file
            );
            if (saveToHistory) {
                saveState();
            }
            saveFilesToLocalStorage(); // Save after updating file content
            updateLineNumbers(); // Update line numbers when content changes
        }

        function handleSave() {
            if (!selectedFileId) {
                showNotification("Lütfen kaydetmek için bir dosya seçin.");
                return;
            }
            const selectedFile = files.find(f => f.id === selectedFileId);
            if (selectedFile && !selectedFile.isFolder) {
                const blob = new Blob([selectedFile.content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = selectedFile.name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showNotification(`"${selectedFile.name}" kaydedildi.`);
            } else {
                showNotification("Seçili öğe bir dosya değil veya kaydedilemez.");
            }
        }

        function handleSaveAsClick() {
            if (!selectedFileId) {
                showNotification("Lütfen kaydetmek için bir dosya seçin.");
                return;
            }
            const selectedFile = files.find(f => f.id === selectedFileId);
            if (selectedFile && !selectedFile.isFolder) {
                saveAsFileNameInput.value = selectedFile.name;
                saveAsModal.classList.remove('hidden');
            } else {
                showNotification("Seçili öğe bir dosya değil veya farklı kaydedilemez.");
            }
        }

        function handleSaveAs() {
            const fileName = saveAsFileNameInput.value.trim();
            if (!selectedFileId || !fileName) {
                showNotification("Lütfen bir dosya seçin ve dosya adını girin.");
                return;
            }
            const selectedFile = files.find(f => f.id === selectedFileId);
            if (selectedFile && !selectedFile.isFolder) {
                const blob = new Blob([selectedFile.content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                saveAsModal.classList.add('hidden');
                showNotification(`"${fileName}" farklı kaydedildi.`);
            }
        }

        function handleRenameClick() {
            if (!selectedFileId) {
                showNotification("Lütfen yeniden adlandırmak için bir dosya veya klasör seçin.");
                return;
            }
            const selectedFile = files.find(f => f.id === selectedFileId);
            newFileNameInputModal.value = selectedFile.name;
            renameModal.classList.remove('hidden');
        }

        function handleRenameConfirm() {
            const newName = newFileNameInputModal.value.trim();
            if (!selectedFileId || !newName) {
                showNotification("Lütfen geçerli bir dosya adı girin.");
                return;
            }

            const selectedFile = files.find(f => f.id === selectedFileId);
            const oldName = selectedFile.name;

            if (newName === oldName) {
                showNotification("Yeni ad mevcut ad ile aynı olamaz.");
                return;
            }

            const nameExists = files.some(file => file.id !== selectedFileId && file.name === newName && file.parentId === selectedFile.parentId);
            if (nameExists) {
                showNotification(`"${newName}" adında bir dosya veya klasör zaten mevcut.`);
                return;
            }

            files = files.map(file =>
                file.id === selectedFileId ? { ...file, name: newName } : file
            );
            files.sort((a, b) => {
                if (a.parentId === null && b.parentId !== null) return -1;
                if (a.parentId !== null && b.parentId === null) return 1;
                if (a.parentId !== null && b.parentId !== null && a.parentId !== b.parentId) {
                    return a.parentId.localeCompare(b.parentId);
                }
                if (a.isFolder && !b.isFolder) return -1;
                if (!a.isFolder && b.isFolder) return 1;
                return a.name.localeCompare(b.name);
            });
            renameModal.classList.add('hidden');
            renderFiles();
            renderEditor();
            saveFilesToLocalStorage(); // Save after renaming
            showNotification(`"${oldName}" "${newName}" olarak yeniden adlandırıldı.`);
        }

        // Helper function to get the full path of a file/folder
        function getFullPath(fileId) {
            let currentFile = files.find(f => f.id === fileId);
            if (!currentFile) return null;

            let pathParts = [currentFile.name];
            let parent = files.find(f => f.id === currentFile.parentId);

            while (parent) {
                pathParts.unshift(parent.name);
                parent = files.find(f => f.id === parent.parentId);
            }
            return pathParts.join('/');
        }

        // Handles saving the entire project as a ZIP file
        async function handleSaveProject() {
            const zip = new JSZip();
            const rootFolderName = "Code_Field_Project"; // Proje adı güncellendi
            const rootFolder = zip.folder(rootFolderName);

            files.forEach(file => {
                const fullPath = getFullPath(file.id);
                if (fullPath) {
                    if (file.isFolder) {
                        rootFolder.folder(fullPath);
                    } else {
                        if (file.type === 'text' || file.type === 'html' || file.type === 'js' || file.type === 'css' || file.type === 'json') {
                            rootFolder.file(fullPath, file.content);
                        } else {
                            // Binary dosyalar için içerik doğrudan saklanmadığı için bir not eklenir.
                            rootFolder.file(fullPath + '.txt', `[${file.name} - Medya Dosyası (İçerik ZIP'e dahil edilmedi)]`);
                        }
                    }
                }
            });

            try {
                const content = await rootFolder.generateAsync({ type: "blob" });
                saveAs(content, `${rootFolderName}.zip`);
                showNotification("Proje başarıyla ZIP olarak kaydedildi!");
            } catch (error) {
                console.error("Proje ZIP oluşturulurken hata oluştu:", error);
                showNotification("Proje kaydedilirken bir hata oluştu.");
            }
        }

        // Kodu çalıştırma veya simüle etme fonksiyonu
        function handleRunCode() {
            const selectedFile = files.find(f => f.id === selectedFileId);
            if (!selectedFile) {
                showNotification("Lütfen çalıştırmak için bir dosya seçin.");
                return;
            }

            // Hide editor, folder, and media player
            fileContentElement.parentElement.classList.add('hidden'); // Hide editor container
            folderContentDisplayElement.classList.add('hidden');
            mediaPlayerDisplayElement.classList.add('hidden');
            simulationContainerElement.classList.remove('hidden'); // Show simulation area

            simulationContainerElement.innerHTML = ''; // Clear previous content

            if (selectedFile.type === 'html') {
                const iframe = document.createElement('iframe');
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                iframe.style.border = 'none';
                iframe.srcdoc = selectedFile.content;
                simulationContainerElement.appendChild(iframe);
                showNotification(`"${selectedFile.name}" simüle ediliyor.`);
            } else if (selectedFile.type === 'text') {
                const pre = document.createElement('pre');
                const code = document.createElement('code');
                code.textContent = selectedFile.content;
                pre.appendChild(code);
                pre.className = 'w-full h-full overflow-auto bg-white p-4 rounded-md';
                simulationContainerElement.appendChild(pre);
                showNotification(`"${selectedFile.name}" içeriği gösteriliyor. Doğrudan çalıştırılamaz.`);
            } else if (selectedFile.type === 'audio' || selectedFile.type === 'video' || selectedFile.type === 'image') {
                // For media files, just show the media player message again
                mediaPlayerDisplayElement.classList.remove('hidden');
                simulationContainerElement.classList.add('hidden'); // Hide simulation container
                showNotification("Bu bir medya dosyasıdır. Çalıştırılamaz.");
            } else if (selectedFile.isFolder) {
                folderContentDisplayElement.classList.remove('hidden');
                simulationContainerElement.classList.add('hidden'); // Hide simulation container
                showNotification("Bu bir klasördür. Çalıştırılamaz.");
            } else {
                showNotification("Bu dosya türü simüle edilemez.");
            }
        }

        // Handles the Undo action.
        function handleUndo() {
            if (undoStack.length > 1) {
                const currentState = undoStack.pop();
                redoStack.push(currentState);
                const previousState = undoStack[undoStack.length - 1];
                applyState(previousState);
                showNotification("Geri alındı.");
            } else {
                showNotification("Geri alınacak başka işlem yok!");
            }
        }

        // Handles the Redo action.
        function handleRedo() {
            if (redoStack.length > 0) {
                const nextState = redoStack.pop();
                undoStack.push(nextState);
                applyState(nextState);
                showNotification("Yinelendi.");
            } else {
                showNotification("Yinelenecek başka işlem yok!");
            }
        }

        // Determine file type based on extension
        function getFileType(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            if (ext === 'html') { // HTML dosyalarını ayrı olarak tanımla
                return 'html';
            } else if (['rpy', 'txt', 'js', 'css', 'json'].includes(ext)) {
                return 'text';
            } else if (['mp3', 'wav', 'ogg'].includes(ext)) {
                return 'audio';
            } else if (['mp4', 'webm', 'mov'].includes(ext)) {
                return 'video';
            } else if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg'].includes(ext)) {
                return 'image';
            }
            return 'unknown'; // Default for unrecognized types
        }

        // Handle file import (now supports ZIP)
        function handleImportFiles(event) {
            const importedFiles = event.target.files;
            if (importedFiles.length === 0) return;

            Array.from(importedFiles).forEach(file => {
                if (file.name.endsWith('.zip')) {
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        try {
                            const zip = await JSZip.loadAsync(e.target.result);
                            const importedItems = [];
                            // Map to store folder paths to their assigned IDs
                            const pathIdMap = { '': null }; // Root path maps to null parentId

                            // First pass: Create folders and build pathIdMap
                            // Sort folder entries by path length to ensure parent folders are processed before children
                            const folderEntries = Object.values(zip.files).filter(entry => entry.dir);
                            folderEntries.sort((a, b) => a.name.length - b.name.length);

                            for (const entry of folderEntries) {
                                const relativePath = entry.name.endsWith('/') ? entry.name.slice(0, -1) : entry.name;
                                const parentPath = relativePath.substring(0, relativePath.lastIndexOf('/'));
                                const parentId = pathIdMap[parentPath] !== undefined ? pathIdMap[parentPath] : null;

                                // Check if a folder with this exact name already exists at this parent level
                                const existingFolder = files.find(f => f.isFolder && f.name === relativePath.split('/').pop() && f.parentId === parentId);
                                if (existingFolder) {
                                    pathIdMap[relativePath] = existingFolder.id; // Use existing folder's ID
                                    console.warn(`Klasör "${relativePath.split('/').pop()}" zaten mevcut, mevcut klasör kullanılıyor.`);
                                    continue; // Skip adding duplicate folder
                                }

                                const newFolder = addFolder(relativePath.split('/').pop(), parentId);
                                importedItems.push(newFolder);
                                pathIdMap[relativePath] = newFolder.id;
                            }

                            // Second pass: Create files
                            const fileEntries = Object.values(zip.files).filter(entry => !entry.dir);
                            for (const entry of fileEntries) {
                                const relativePath = entry.name;
                                const fileName = relativePath.split('/').pop();
                                const parentPath = relativePath.substring(0, relativePath.lastIndexOf('/'));
                                const parentId = pathIdMap[parentPath] !== undefined ? pathIdMap[parentPath] : null;

                                const fileType = getFileType(fileName);
                                let fileContent = '';

                                if (fileType === 'text' || fileType === 'html' || fileType === 'js' || fileType === 'css' || fileType === 'json') {
                                    fileContent = await entry.async('text');
                                } else {
                                    fileContent = `[${fileName} - Binary Dosya (İçerik burada gösterilemez)]`;
                                }

                                // Check if a file with this exact name already exists at this parent level
                                const existingFile = files.find(f => !f.isFolder && f.name === fileName && f.parentId === parentId);
                                if (existingFile) {
                                    console.warn(`Dosya "${fileName}" zaten mevcut, üzerine yazılıyor.`);
                                    // Update existing file content instead of adding new
                                    files = files.map(f => f.id === existingFile.id ? { ...f, content: fileContent, type: fileType } : f);
                                    continue;
                                }

                                addFile(fileName, fileContent, fileType, parentId);
                            }

                            // Re-render and save after all items are processed
                            files.sort((a, b) => {
                                if (a.parentId === null && b.parentId !== null) return -1;
                                if (a.parentId !== null && b.parentId === null) return 1;
                                if (a.parentId !== null && b.parentId !== null && a.parentId !== b.parentId) {
                                    return a.parentId.localeCompare(b.parentId);
                                }
                                if (a.isFolder && !b.isFolder) return -1;
                                if (!a.isFolder && b.isFolder) return 1;
                                return a.name.localeCompare(b.name);
                            });
                            renderFiles();
                            renderEditor();
                            saveFilesToLocalStorage();
                            showNotification("ZIP dosyası başarıyla içe aktarıldı!");

                        } catch (error) {
                            console.error("ZIP dosyasını işlerken hata oluştu:", error);
                            showNotification("ZIP dosyası içe aktarılırken bir hata oluştu.");
                        }
                    };
                    reader.readAsArrayBuffer(file);
                } else {
                    // Existing single file import logic
                    const reader = new FileReader();
                    const fileType = getFileType(file.name);

                    reader.onload = (e) => {
                        let fileContent = '';
                        if (fileType === 'text' || fileType === 'html' || fileType === 'js' || fileType === 'css' || fileType === 'json') {
                            fileContent = e.target.result;
                        } else {
                            fileContent = `[${file.name} - Binary Dosya (İçerik burada gösterilemez)]`;
                        }
                        
                        addFile(file.name, fileContent, fileType);
                    };

                    if (fileType === 'text' || fileType === 'html' || fileType === 'js' || fileType === 'css' || fileType === 'json') {
                        reader.readAsText(file);
                    } else {
                        reader.readAsArrayBuffer(file);
                    }
                    showNotification("Dosya içe aktarıldı.");
                }
            });

            // Clear the input value so that selecting the same file again triggers change event
            event.target.value = '';
        }

        // Satır numaralarını güncelleme fonksiyonu
        function updateLineNumbers() {
            if (!fileContentElement || !lineNumbersElement) return;

            const content = fileContentElement.value;
            const lines = content.split('\n');
            let lineNumbersHtml = '';
            for (let i = 1; i <= lines.length; i++) {
                lineNumbersHtml += `<div>${i}</div>`;
            }
            lineNumbersElement.innerHTML = lineNumbersHtml;

            // Satır numaraları div'inin yüksekliğini textarea'nın scroll yüksekliğine eşitle
            // Bu, textarea'nın içeriği değiştiğinde satır numaralarının da doğru yüksekliğe sahip olmasını sağlar.
            // Ayrıca, textarea'nın scroll'u ile lineNumbers'ın scroll'unu senkronize etmek için
            // scroll olay dinleyicisi kullanılacak.
            lineNumbersElement.scrollTop = fileContentElement.scrollTop;
        }

        // --- Olay Dinleyicileri ---
        document.addEventListener('DOMContentLoaded', () => {
            // DOM elementlerini burada al
            fileListElement = document.getElementById('fileList');
            fileContentElement = document.getElementById('fileContent');
            selectedFileNameElement = document.getElementById('selectedFileName');
            folderContentDisplayElement = document.getElementById('folderContentDisplay');
            folderChildrenListElement = document.getElementById('folderChildrenList');
            mediaPlayerDisplayElement = document.getElementById('mediaPlayerDisplay');
            customNotificationElement = document.getElementById('customNotification');
            simulationContainerElement = document.getElementById('simulationContainer');
            lineNumbersElement = document.getElementById('lineNumbers'); // Yeni satır numaraları elementi

            addFileBtn = document.getElementById('addFileBtn');
            addFolderBtn = document.getElementById('addFolderBtn');
            deleteFileBtn = document.getElementById('deleteFileBtn');
            clearFileContentBtn = document.getElementById('clearFileContentBtn');
            saveFileBtn = document.getElementById('saveFileBtn');
            saveAsFileBtn = document.getElementById('saveAsFileBtn');
            saveProjectBtn = document.getElementById('saveProjectBtn');
            renameFileBtn = document.getElementById('renameFileBtn');
            resetProjectBtn = document.getElementById('resetProjectBtn');
            importFileBtn = document.getElementById('importFileBtn');
            importFileInput = document.getElementById('importFileInput');

            runCodeBtn = document.getElementById('runCodeBtn');
            undoBtn = document.getElementById('undoBtn');
            redoBtn = document.getElementById('redoBtn');

            saveAsModal = document.getElementById('saveAsModal');
            closeSaveAsModalBtn = document.getElementById('closeSaveAsModalBtn');
            saveAsFileNameInput = document.getElementById('saveAsFileNameInput');
            confirmSaveAsBtn = document.getElementById('confirmSaveAsBtn');
            cancelSaveAsBtn = document.getElementById('cancelSaveAsBtn');

            renameModal = document.getElementById('renameModal');
            closeRenameModalBtn = document.getElementById('closeRenameModalBtn');
            newFileNameInputModal = document.getElementById('newFileNameInputModal');
            confirmRenameBtn = document.getElementById('confirmRenameBtn');
            cancelRenameBtn = document.getElementById('cancelRenameBtn');

            confirmationModal = document.getElementById('confirmationModal');
            confirmationModalTitle = document.getElementById('confirmationModalTitle');
            confirmationModalMessage = document.getElementById('confirmationModalMessage');
            confirmActionBtn = document.getElementById('confirmActionBtn');
            cancelActionBtn = document.getElementById('cancelActionBtn');

            // Elementlerin varlığını kontrol et
            if (!fileListElement || !fileContentElement || !selectedFileNameElement || !folderContentDisplayElement || !folderChildrenListElement || !mediaPlayerDisplayElement || !customNotificationElement || !simulationContainerElement || !lineNumbersElement || !addFileBtn || !addFolderBtn || !deleteFileBtn || !clearFileContentBtn || !saveFileBtn || !saveAsFileBtn || !saveProjectBtn || !renameFileBtn || !resetProjectBtn || !importFileBtn || !importFileInput || !runCodeBtn || !undoBtn || !redoBtn || !saveAsModal || !closeSaveAsModalBtn || !saveAsFileNameInput || !confirmSaveAsBtn || !cancelSaveAsBtn || !renameModal || !closeRenameModalBtn || !newFileNameInputModal || !confirmRenameBtn || !cancelRenameBtn || !confirmationModal || !confirmationModalTitle || !confirmationModalMessage || !confirmActionBtn || !cancelActionBtn) {
                console.error("Hata: Gerekli DOM elementlerinden biri veya birkaçı bulunamadı! Sayfa düzgün yüklenemedi.");
                return; // Eğer elementler yoksa daha fazla ilerleme
            }


            loadFilesFromLocalStorage(); // Uygulama başlatıldığında dosyaları yükle
            renderFiles();
            renderEditor(); // Bu çağrı updateLineNumbers'ı tetikleyecek

            // İlk yüklemede undo stack'e mevcut içeriği ekle
            if (selectedFileId) {
                const initialContent = files.find(f => f.id === selectedFileId)?.content || '';
                if (undoStack.length === 0) { // Sadece boşsa ekle, loadFilesFromLocalStorage zaten doldurmuş olabilir
                    undoStack.push(initialContent);
                }
            }

            addFileBtn.addEventListener('click', () => addFile());
            addFolderBtn.addEventListener('click', () => addFolder()); // Klasör ekleme fonksiyonu çağrısı güncellendi
            deleteFileBtn.addEventListener('click', deleteFile);
            clearFileContentBtn.addEventListener('click', clearFileContent);
            saveFileBtn.addEventListener('click', handleSave);
            saveAsFileBtn.addEventListener('click', handleSaveAsClick);
            saveProjectBtn.addEventListener('click', handleSaveProject);
            renameFileBtn.addEventListener('click', handleRenameClick);
            resetProjectBtn.addEventListener('click', () => {
                showConfirmationModal("Projeyi Sıfırla", "Tüm projenizi varsayılan ayarlara sıfırlamak istediğinizden emin misiniz? Bu işlem geri alınamaz.", resetToDefaultFiles);
            });

            runCodeBtn.addEventListener('click', handleRunCode);
            undoBtn.addEventListener('click', handleUndo);
            redoBtn.addEventListener('click', handleRedo);

            fileContentElement.addEventListener('input', (e) => {
                updateFileContent(e.target.value, true);
            });

            // Textarea scroll olduğunda satır numaralarını senkronize et
            fileContentElement.addEventListener('scroll', () => {
                lineNumbersElement.scrollTop = fileContentElement.scrollTop;
            });

            // İçe Aktar butonu ve gizli input için olay dinleyicileri
            importFileBtn.addEventListener('click', () => importFileInput.click());
            importFileInput.addEventListener('change', handleImportFiles);


            // Farklı Kaydet Modal Olay Dinleyicileri
            closeSaveAsModalBtn.addEventListener('click', () => saveAsModal.classList.add('hidden'));
            cancelSaveAsBtn.addEventListener('click', () => saveAsModal.classList.add('hidden'));
            confirmSaveAsBtn.addEventListener('click', handleSaveAs);

            // Yeniden Adlandır Modal Olay Dinleyicileri
            closeRenameModalBtn.addEventListener('click', () => renameModal.classList.add('hidden'));
            cancelRenameBtn.addEventListener('click', () => renameModal.classList.add('hidden'));
            confirmRenameBtn.addEventListener('click', handleRenameConfirm);

            // Onay Modalı Olay Dinleyicileri
            confirmActionBtn.addEventListener('click', () => {
                if (currentConfirmationCallback) {
                    currentConfirmationCallback();
                }
            });
            cancelActionBtn.addEventListener('click', hideConfirmationModal);

            // Klavye kısayolları için event listener
            document.addEventListener('keydown', (e) => {
                // Ctrl + S: Kaydet
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    handleSave();
                }
                // Ctrl + Shift + S: Farklı Kaydet
                if (e.ctrlKey && e.shiftKey && e.key === 'S') {
                    e.preventDefault();
                    handleSaveAsClick();
                }
                // Ctrl + Alt + S: Projeyi ZIP olarak kaydet
                if (e.ctrlKey && e.altKey && e.key === 's') {
                    e.preventDefault();
                    handleSaveProject();
                }
                // Ctrl + Z: Geri Al
                if (e.ctrlKey && e.key === 'z') {
                    e.preventDefault();
                    handleUndo();
                }
                // Ctrl + Y: Yinele
                if (e.ctrlKey && e.key === 'y') {
                    e.preventDefault();
                    handleRedo();
                }
                // Ctrl + N: Yeni Dosya Ekle
                if (e.ctrlKey && e.key === 'n') {
                    e.preventDefault();
                    addFile();
                }
                // Ctrl + Shift + N: Yeni Klasör Ekle
                if (e.ctrlKey && e.shiftKey && e.key === 'N') {
                    e.preventDefault();
                    addFolder();
                }
                // Ctrl + I: İçe Aktar
                if (e.ctrlKey && e.key === 'i') {
                    e.preventDefault();
                    importFileInput.click();
                }
                // Delete: Dosyayı Sil
                if (e.key === 'Delete') {
                    e.preventDefault();
                    deleteFile();
                }
                // F2: Yeniden Adlandır
                if (e.key === 'F2') {
                    e.preventDefault();
                    handleRenameClick();
                }
                // Ctrl + E: İçeriği Temizle
                if (e.ctrlKey && e.key === 'e') {
                    e.preventDefault();
                    clearFileContent();
                }
                // Ctrl + R: Kodu Çalıştır
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    handleRunCode();
                }
                // Ctrl + Shift + R: Projeyi Sıfırla
                if (e.ctrlKey && e.shiftKey && e.key === 'R') {
                    e.preventDefault();
                    showConfirmationModal("Projeyi Sıfırla", "Tüm projenizi varsayılan ayarlara sıfırlamak istediğinizden emin misiniz? Bu işlem geri alınamaz.", resetToDefaultFiles);
                }
            });


            // Drag and Drop Event Listeners (Delegated to fileListElement)
            fileListElement.addEventListener('dragstart', (e) => {
                const listItem = e.target.closest('li');
                if (listItem) {
                    e.dataTransfer.setData('text/plain', listItem.dataset.fileId);
                    e.dataTransfer.effectAllowed = "move";
                }
            });

            fileListElement.addEventListener('dragenter', (e) => {
                e.preventDefault();
                const listItem = e.target.closest('li');
                if (listItem) {
                    listItem.classList.add('drag-over-target');
                } else {
                    fileListElement.classList.add('drag-over-target');
                }
            });

            fileListElement.addEventListener('dragleave', (e) => {
                const listItem = e.target.closest('li');
                if (listItem) {
                    listItem.classList.remove('drag-over-target');
                } else {
                    fileListElement.classList.remove('drag-over-target');
                }
            });

            fileListElement.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            fileListElement.addEventListener('drop', (e) => {
                e.preventDefault();
                fileListElement.querySelectorAll('li').forEach(li => li.classList.remove('drag-over-target'));
                fileListElement.classList.remove('drag-over-target');

                const draggedFileId = e.dataTransfer.getData('text/plain');
                const draggedItem = files.find(f => f.id === draggedFileId);

                if (!draggedItem) {
                    return;
                }

                const droppedOnElement = e.target.closest('li[data-file-id]');
                let newParentId = null;

                if (droppedOnElement) {
                    const droppedOnFileId = droppedOnElement.dataset.fileId;
                    const droppedOnItem = files.find(f => f.id === droppedOnFileId);

                    if (!droppedOnItem) {
                        renderFiles();
                        return;
                    }
                    if (draggedItem.id === droppedOnItem.id) {
                        renderFiles();
                        return;
                    }

                    if (draggedItem.isFolder) {
                        let currentParent = droppedOnItem;
                        while (currentParent) {
                            if (currentParent.id === draggedItem.id) {
                                showNotification("Klasörü kendi alt klasörlerinden birine taşıyamazsınız.");
                                renderFiles();
                                return;
                            }
                            currentParent = files.find(f => f.id === currentParent.parentId);
                        }
                    }

                    if (droppedOnItem.isFolder) {
                        newParentId = droppedOnItem.id;
                    } else {
                        newParentId = droppedOnItem.parentId;
                    }
                }

                draggedItem.parentId = newParentId;

                files.sort((a, b) => {
                    if (a.parentId === null && b.parentId !== null) return -1;
                    if (a.parentId !== null && b.parentId === null) return 1;
                    if (a.parentId !== null && b.parentId !== null && a.parentId !== b.parentId) {
                        return a.parentId.localeCompare(b.parentId);
                    }
                    if (a.isFolder && !b.isFolder) return -1;
                    if (!a.isFolder && b.isFolder) return 1;
                    return a.name.localeCompare(b.name);
                });

                renderFiles();
                renderEditor();
                saveFilesToLocalStorage(); // Save after drag and drop
            });
        });
    </script>
</head>
<body class="min-h-screen bg-gray-100 flex flex-col">

    <!-- 1. Sitenin ilk 1920x1080 kısmı - Artık menü içeriyor -->
    <div
        class="w-full h-screen bg-cover bg-center rounded-b-lg shadow-lg"
        style="background-image: url(https://4kwallpapers.com/images/walls/thumbs_3t/22850.jpg)"
    >
        <!-- Arka plan kaplaması kaldırıldı. Menü doğrudan resmin üzerinde. -->
        <nav class="flex items-center justify-start h-full text-white rounded-b-lg p-4 pl-12 w-2/5">
            <ul class="flex flex-col space-y-6"> <!-- flex-row yerine flex-col ve space-x-6 yerine space-y-6 kullanıldı -->
                <li><a href="index.html" class="text-7xl font-bold hover:text-[#7b3e1d] transition-colors duration-300 menu-font">Code Field</a></li>
                <li><a href="ikinci.html" class="text-7xl font-bold hover:text-[#7b3e1d] transition-colors duration-300 menu-font">Levia Field</a></li>
            </ul>
        </nav>
    </div>

    <!-- 2. Sitenin üstteki resmin altındaki rengi -->
    <div class="flex-grow bg-[#E6CBB0] p-4 md:p-8 flex flex-col items-center relative">
        <!-- 4. Visual Studio Code benzeri bir menü -->
        <div class="w-full max-w-6xl bg-white rounded-lg shadow-xl overflow-hidden flex flex-col md:flex-row min-h-[600px]">
            <!-- Sol Menü -->
            <div class="w-full md:w-1/4 bg-[#7C3D1D] text-white p-4 flex flex-col rounded-l-lg md:rounded-l-lg md:rounded-tr-none rounded-t-lg">
                <div class="text-lg font-bold mb-4 flex justify-between items-center">
                    Dosyalar
                    <div class="flex space-x-2">
                        <button id="addFileBtn"
                            class="bg-white text-[#7C3D1D] font-bold py-1 px-2 rounded-full transition duration-300 transform hover:scale-105 shadow-md flex items-center justify-center"
                            title="Yeni Dosya Ekle (Ctrl + N)"
                        >
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6">
                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                <g id="SVGRepo_iconCarrier">
                                    <path d="M17 19H21M19 17V21M13 3H8.2C7.0799 3 6.51984 3 6.09202 3.21799C5.71569 3.40973 5.40973 3.71569 5.21799 4.09202C5 4.51984 5 5.0799 5 6.2V17.8C5 18.9201 5 19.4802 5.21799 19.908C5.40973 20.2843 5.71569 20.5903 6.09202 20.782C6.51984 21 7.0799 21 8.2 21H12M13 3L19 9M13 3V7.4C13 7.96005 13 8.24008 13.109 8.45399C13.2049 8.64215 13.3578 8.79513 13.546 8.89101C13.7599 9 14.0399 9 14.6 9H19M19 9V12M9 17H12M9 13H15M9 9H10" stroke="#7C3D1D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                </g>
                            </svg>
                        </button>
                        <button id="addFolderBtn"
                            class="bg-white text-[#7C3D1D] font-bold py-1 px-2 rounded-full transition duration-300 transform hover:scale-105 shadow-md flex items-center justify-center"
                            title="Yeni Klasör Ekle (Ctrl + Shift + N)"
                        >
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6">
                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                <g id="SVGRepo_iconCarrier">
                                    <path d="M9 13H15M12 10V16M12.0627 6.06274L11.9373 5.93726C11.5914 5.59135 11.4184 5.4184 11.2166 5.29472C11.0376 5.18506 10.8425 5.10425 10.6385 5.05526C10.4083 5 10.1637 5 9.67452 5H6.2C5.0799 5 4.51984 5 4.09202 5.21799C3.71569 5.40973 3.40973 5.71569 3.21799 6.09202C3 6.51984 3 7.0799 3 8.2V15.8C3 16.9201 3 17.4802 3.21799 17.908C3.40973 18.2843 3.71569 18.5903 4.09202 18.782C4.51984 19 5.07989 19 6.2 19H17.8C18.9201 19 19.4802 19 19.908 18.782C20.2843 18.5903 20.5903 18.2843 20.782 17.908C21 17.4802 21 16.9201 21 15.8V10.2C21 9.0799 21 8.51984 21.782 8.09202C20.5903 7.71569 20.2843 7.40973 19.908 7.21799C19.4802 7 18.9201 7 17.8 7H14.3255C13.8363 7 13.5917 7 13.3615 6.94474C13.1575 6.89575 12.9624 6.81494 12.7834 6.70528C12.5816 6.5816 12.4086 6.40865 12.0627 6.06274Z" stroke="#7C3D1D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                </g>
                            </svg>
                        </button>
                    </div>
                </div>
                <ul id="fileList" class="flex-grow overflow-y-auto">
                    <!-- Dosyalar buraya JavaScript tarafından render edilecek -->
                </ul>
            </div>

            <!-- Sağ Kod Yeri -->
            <div class="w-full md:w-3/4 bg-white p-4 flex flex-col rounded-r-lg md:rounded-r-lg md:rounded-bl-none rounded-b-lg">
                <div id="selectedFileName" class="text-lg font-bold mb-2">
                    Dosya Seçilmedi
                </div>
                <!-- Editor Container (Line Numbers + Textarea) -->
                <div id="editorContainer" class="editor-container hidden">
                    <div id="lineNumbers" class="line-numbers">
                        <!-- Line numbers will be rendered here -->
                    </div>
                    <textarea id="fileContent"
                        class="flex-grow w-full p-4 resize-none focus:outline-none focus:ring-2 focus:ring-[#7C3D1D] text-sm leading-relaxed"
                        placeholder="Kodunuzu buraya yazın..."
                        wrap="off"
                    ></textarea>
                </div>

                <div id="folderContentDisplay" class="flex-grow w-full p-4 border border-gray-300 rounded-md bg-gray-100 text-gray-600 flex flex-col items-center justify-center hidden">
                    <p class="mb-2">Klasör içeriği burada gösterilecektir:</p>
                    <ul id="folderChildrenList" class="list-disc list-inside text-left w-full pl-4">
                        <!-- Folder contents will be listed here -->
                    </ul>
                    <p class="mt-4 text-sm text-gray-500">Bir dosyanın içeriğini düzenlemek için, yukarıdaki listeden o dosyaya tıklayın.</p>
                </div>

                <!-- Medya Oynatma Alanı -->
                <div id="mediaPlayerDisplay" class="flex-grow w-full p-4 border border-gray-300 rounded-md bg-gray-100 text-gray-600 flex flex-col items-center justify-center hidden">
                    <p class="mb-2 text-center">Bu bir medya dosyasıdır. Düzenleyici içinde doğrudan oynatma desteklenmemektedir.</p>
                    <p class="text-sm text-gray-500">Dosyayı indirmek için "Kaydet" butonunu kullanabilirsiniz.</p>
                </div>

                <!-- Simülasyon Çıktı Alanı -->
                <div id="simulationContainer" class="flex-grow w-full p-4 border border-gray-300 rounded-md bg-gray-100 hidden flex flex-col items-center justify-center">
                    <!-- İçerik buraya JavaScript tarafından eklenecek (iframe veya pre/code) -->
                </div>


                <!-- Kod yazma yerinin ve sol menünün altına kaydet vb. tuşlar -->
                <div class="mt-4 flex flex-wrap justify-end gap-2">
                    <button id="runCodeBtn"
                        class="bg-[#7C3D1D] text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center"
                        title="Kodu Çalıştır / Simüle Et (Ctrl + R)"
                    >
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <g id="System / Terminal">
                                    <path id="Vector" d="M17 15H12M7 10L10 12.5L7 15M3 15.8002V8.2002C3 7.08009 3 6.51962 3.21799 6.0918C3.40973 5.71547 3.71547 5.40973 4.0918 5.21799C4.51962 5 5.08009 5 6.2002 5H17.8002C18.9203 5 19.4796 5 19.9074 5.21799C20.2837 5.40973 20.5905 5.71547 20.7822 6.0918C21 6.5192 21 7.07899 21 8.19691V15.8031C21 16.921 21 17.48 20.7822 17.9074C20.5905 18.2837 20.2837 18.5905 19.9074 18.7822C19.48 19 18.921 19 17.8031 19H6.19691C5.07899 19 4.5192 19 4.0918 18.7822C3.71547 18.5905 3.40973 18.2837 3.21799 17.9074C3 17.4796 3 16.9203 3 15.8002Z" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                </g>
                            </svg>
                    </button>
                    <button id="undoBtn"
                        class="bg-[#7C3D1D] text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center"
                        title="Geri Al (Ctrl + Z)"
                    >
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <g id="Edit / Undo">
                                    <path id="Vector" d="M10 8H5V3M5.29102 16.3569C6.22284 17.7918 7.59014 18.8902 9.19218 19.4907C10.7942 20.0913 12.547 20.1624 14.1925 19.6937C15.8379 19.225 17.2893 18.2413 18.3344 16.8867C19.3795 15.5321 19.963 13.878 19.9989 12.1675C20.0347 10.4569 19.5211 8.78001 18.5337 7.38281C17.5462 5.98561 16.1366 4.942 14.5122 4.40479C12.8878 3.86757 11.1341 3.86499 9.5083 4.39795C7.88252 4.93091 6.47059 5.97095 5.47949 7.36556" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                </g>
                            </g>
                        </svg>
                    </button>
                    <button id="redoBtn"
                        class="bg-[#7C3D1D] text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center"
                        title="Yinele (Ctrl + Y)"
                    >
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <g id="Edit / Redo">
                                    <path id="Vector" d="M13.9998 8H18.9998V3M18.7091 16.3569C17.7772 17.7918 16.4099 18.8902 14.8079 19.4907C13.2059 20.0913 11.4534 20.1624 9.80791 19.6937C8.16246 19.225 6.71091 18.2413 5.66582 16.8867C4.62073 15.5321 4.03759 13.878 4.00176 12.1675C3.96593 10.4569 4.47903 8.78001 5.46648 7.38281C6.45392 5.98561 7.86334 4.942 9.48772 4.40479C11.1121 3.86757 12.8661 3.86499 14.4919 4.39795C16.1177 4.93091 17.5298 5.97095 18.5209 7.36556" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                </g>
                            </g>
                        </svg>
                    </button>
                    <button id="saveFileBtn"
                        class="bg-[#7C3D1D] text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center"
                        title="Kaydet (Ctrl + S)"
                    >
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M18.1716 1C18.702 1 19.2107 1.21071 19.5858 1.58579L22.4142 4.41421C22.7893 4.78929 23 5.29799 23 5.82843V20C23 21.6569 21.6569 23 20 23H4C2.34315 23 1 21.6569 1 20V4C1 2.34315 2.34315 1 4 1H18.1716ZM4 3C3.44772 3 3 3.44772 3 4V20C3 20.5523 3.44772 21 4 21L5 21L5 15C5 13.3431 6.34315 12 8 12L16 12C17.6569 12 19 13.3431 19 15V21H20C20.5523 21 21 20.5523 21 20V6.82843C21 6.29799 20.7893 5.78929 20.4142 5.41421L18.5858 3.58579C18.2107 3.21071 17.702 3 17.1716 3H17V5C17 6.65685 15.6569 8 14 8H10C8.34315 8 7 6.65685 7 5V3H4ZM17 21V15C17 14.4477 16.5523 14 16 14L8 14C7.44772 14 7 14.4477 7 15L7 21L17 21ZM9 3H15V5C15 5.55228 14.5523 6 14 6H10C9.44772 6 9 5.55228 9 5V3Z" fill="#FFFFFF"></path>
                            </g>
                        </svg>
                    </button>
                    <button id="saveAsFileBtn"
                        class="bg-[#7C3D1D] text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center"
                        title="Farklı Kaydet (Ctrl + Shift + S)"
                    >
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <path d="M5.75 3C4.23122 3 3 4.23122 3 5.75V18.25C3 19.7688 4.23122 21 5.75 21H9.99852C9.99129 20.8075 10.011 20.6088 10.0613 20.4075L10.2882 19.5H7.5V14.25C7.5 13.8358 7.83579 13.5 8.25 13.5H14.8531L16.2883 12.0648C16.1158 12.0225 15.9355 12 15.75 12H8.25C7.00736 12 6 13.0074 6 14.25V19.5H5.75C5.05964 19.5 4.5 18.9404 4.5 18.25V5.75C4.5 5.05964 5.05964 4.5 5.75 4.5H7V7.25C7 8.49264 8.00736 9.5 9.25 9.5H13.75C14.9926 9.5 16 8.49264 16 7.25V4.52344C16.3582 4.58269 16.6918 4.75246 16.9519 5.01256L18.9874 7.0481C19.3156 7.37629 19.5 7.8214 19.5 8.28553V10.007C19.5709 10.0024 19.642 10 19.713 10H19.7151C20.1521 10.0002 20.59 10.0874 21 10.2615V8.28553C21 7.42358 20.6576 6.59693 20.0481 5.98744L18.0126 3.9519C17.4031 3.34241 16.5764 3 15.7145 3H5.75ZM8.5 7.25V4.5H14.5V7.25C14.5 7.66421 14.1642 8 13.75 8H9.25C8.83579 8 8.5 7.66421 8.5 7.25Z" fill="#FFFFFF"></path>
                                <path d="M19.7152 11H19.7131C19.1285 11.1234 18.5439 11.2234 18.0979 11.6695L12.1955 17.5719C11.8513 17.916 11.6072 18.3472 11.4892 18.8194L11.0315 20.6501C10.8325 21.4462 11.5536 22.1674 12.3497 21.9683L14.1804 21.5106C14.6526 21.3926 15.0838 21.1485 15.4279 20.8043L21.3303 14.9019C22.223 14.0093 22.223 12.5621 21.3303 11.6695C20.8843 11.2234 20.2998 11.0003 19.7152 11Z" fill="#FFFFFF"></path>
                            </g>
                        </svg>
                    </button>
                    <button id="saveProjectBtn"
                        class="bg-[#7C3D1D] text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center"
                        title="Projeyi ZIP olarak kaydet (Ctrl + Alt + S)"
                    >
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <path d="M12 9.5V15.5M12 15.5L10 13.5M12 15.5L14 13.5M8.4 19C5.41766 19 3 16.6044 3 13.6493C3 11.2001 4.8 8.9375 7.5 8.5C8.34694 6.48637 10.3514 5 12.6893 5C15.684 5 18.1317 7.32251 18.3 10.25C19.8893 10.9449 21 12.6503 21 14.4969C21 16.9839 18.9853 19 16.5 19L8.4 19Z" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </g>
                        </svg>
                    </button>
                    <button id="importFileBtn"
                        class="bg-[#7C3D1D] text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center"
                        title="İçe Aktar (Ctrl + I)"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <path d="M12 3v12"></path>
                                <path d="M8 11l4 4 4-4"></path>
                                <path d="M8 5H4a2 2 0 00-2 2v10a2 2 0 002 2h16a2 2 0 002-2V7a2 2 0 00-2-2h-4"></path>
                            </g>
                        </svg>
                    </button>
                    <button id="deleteFileBtn"
                        class="bg-[#7C3D1D] text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center"
                        title="Dosyayı Sil (Del)"
                    >
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <path d="M10 11V17" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                <path d="M14 11V17" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                <path d="M4 7H20" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                <path d="M6 7H12H18V18C18 19.6569 16.6569 21 15 21H9C7.34315 21 6 19.6569 6 18V7Z" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                                <path d="M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5V7H9V5Z" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </g>
                        </svg>
                    </button>
                    <button id="clearFileContentBtn"
                        class="bg-[#7C3D1D] text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center"
                        title="İçeriği Temizle (Ctrl + E)"
                    >
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <path d="M12.0004 9.5L17.0004 14.5M17.0004 9.5L12.0004 14.5M4.50823 13.9546L7.43966 17.7546C7.79218 18.2115 7.96843 18.44 8.18975 18.6047C8.38579 18.7505 8.6069 18.8592 8.84212 18.9253C9.10766 19 9.39623 19 9.97336 19H17.8004C18.9205 19 19.4806 19 19.9084 18.782C20.2847 18.5903 20.5907 18.2843 20.7824 17.908C21.0004 17.4802 21.0004 16.9201 21.0004 15.8V8.2C21.0004 7.0799 21.0004 6.51984 20.7824 6.09202C20.5907 5.71569 20.2847 5.40973 19.9084 5.21799C19.4806 5 18.9205 5 17.8004 5H9.97336C9.39623 5 9.10766 5 8.84212 5.07467C8.6069 5.14081 8.38579 5.2495 8.18975 5.39534C7.96843 5.55998 7.79218 5.78846 7.43966 6.24543L4.50823 10.0454C3.96863 10.7449 3.69883 11.0947 3.59505 11.4804C3.50347 11.8207 3.50347 12.1793 3.59505 12.5196C3.69883 12.9053 3.96863 13.2551 4.50823 13.9546Z" stroke="#FFFFFF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                            </g>
                        </svg>
                    </button>

                    <!-- Yeniden Adlandır Butonu -->
                    <button id="renameFileBtn"
                        class="bg-[#7C3D1D] text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center"
                        title="Yeniden Adlandır (F2)"
                    >
                        <svg viewBox="0 0 512 512" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#FFFFFF" class="w-6 h-6">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <title>rename</title>
                                <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                    <g id="Combined-Shape" fill="#FFFFFF" transform="translate(42.666667, 64.000000)">
                                        <path d="M362.666667,1.42108547e-14 L362.666667,21.3333333 L320,21.333 L320,362.666 L362.666667,362.666667 L362.666667,384 L320,383.999 L320,384 L298.666667,384 L298.666,383.999 L256,384 L256,362.666667 L298.666,362.666 L298.666,21.333 L256,21.3333333 L256,1.42108547e-14 L362.666667,1.42108547e-14 Z M426.666667,64 L426.666667,320 L341.333333,320 L341.333333,277.333333 L384,277.333333 L384,106.666667 L341.333333,106.666667 L341.333333,64 L426.666667,64 Z M277.333333,64 L277.333333,320 L3.55271368e-14,320 L3.55271368e-14,64 L277.333333,64 Z M179.2,89.6 L149.333333,89.6 L149.333333,234.666667 C149.333333,248 148.5,256.333333 147.875,264.354167 L147.792993,265.422171 L147.792993,265.422171 L147.714003,266.48894 C147.417695,270.579012 147.2,274.696296 147.2,279.466667 L147.2,279.466667 L177.066667,279.466667 L177.066667,260.266667 C184.941497,273.926888 199.708077,282.130544 215.466667,281.6 C229.540046,281.805757 242.921593,275.508559 251.733333,264.533333 C263.162478,248.989677 269.832496,230.461848 270.933333,211.2 C270.933333,170.666667 249.6,142.933333 217.6,142.933333 C202.507405,142.999748 188.308689,150.099106 179.2,162.133333 L179.2,162.133333 L179.2,89.6 Z M119.466667,162.133333 C107.961824,149.843793 91.4322333,143.546807 74.6666667,145.066667 C57.6785115,144.485924 40.8138255,148.15216 25.6,155.733333 L25.6,155.733333 L34.1333333,177.066667 C45.3979052,171.147831 57.7246848,167.522308 70.4,166.4 C78.5613135,165.511423 86.6853595,168.371259 92.4903835,174.176283 C98.2954074,179.981307 101.155244,188.105353 100.266667,196.266667 L100.266667,196.266667 L100.266667,198.4 L78.9333333,198.4 C65.8181975,197.679203 52.705771,199.864608 40.5333333,204.8 C26.2806563,210.950309 17.6507691,225.621117 19.2,241.066667 C19.0625857,252.057651 23.6679763,262.574827 31.8381493,269.927982 C40.0083223,277.281138 50.9508304,280.757072 61.8666667,279.466667 C77.2795695,280.291768 92.2192911,274.001359 102.4,262.4 L102.4,262.4 L102.4,277.333333 L130.133333,277.333333 C128.292479,266.054406 127.577851,254.620365 128,243.2 L128,243.2 L128,204.8 C129.999138,190.023932 126.995128,175.003882 119.466667,162.133333 Z M98.1333333,213.333333 L98.1333333,238.933333 C92.082572,249.988391 80.836024,257.218314 68.2666667,258.133333 C63.0655139,258.520242 57.9538681,256.621996 54.2659359,252.934064 C50.5780036,249.246132 48.6797582,244.134486 49.0666667,238.933333 C49.0666667,224 59.7333333,215.466667 85.3333333,213.333333 L85.3333333,213.333333 L98.1333333,213.333333 Z M209.066667,166.4 C226.133333,166.4 238.933333,183.466667 238.933333,211.2 C238.933333,238.933333 228.266667,256 211.2,256 C197.298049,255.69869 184.825037,247.383349 179.2,234.666667 L179.2,234.666667 L179.2,187.733333 C185.154203,176.240507 196.263981,168.304951 209.066667,166.4 Z" />
                                    </g>
                                </g>
                            </g>
                        </svg>
                    </button>
                    <!-- Projeyi Sıfırla Butonu -->
                    <button id="resetProjectBtn"
                        class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105 flex items-center justify-center"
                        title="Projeyi Sıfırla (Ctrl + Shift + R)"
                    >
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6">
                            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                            <g id="SVGRepo_iconCarrier">
                                <path d="M7 5C5.34315 5 4 6.34315 4 8V16C4 17.6569 5.34315 19 7 19H17C18.6569 19 20 17.6569 20 16V12.5C20 11.9477 20.4477 11.5 21 11.5C21.5523 11.5 22 11.9477 22 12.5V16C22 18.7614 19.7614 21 17 21H7C4.23858 21 2 18.7614 2 16V8C2 5.23858 4.23858 3 7 3H10.5C11.0523 3 11.5 3.44772 11.5 4C11.5 4.55228 11.0523 5 10.5 5H7Z" fill="#FFFFFF"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M18.8431 3.58579C18.0621 2.80474 16.7957 2.80474 16.0147 3.58579L11.6806 7.91992L11.0148 11.9455C10.8917 12.6897 11.537 13.3342 12.281 13.21L16.3011 12.5394L20.6347 8.20582C21.4158 7.42477 21.4158 6.15844 20.6347 5.37739L18.8431 3.58579ZM13.1933 11.0302L13.5489 8.87995L17.4289 5L19.2205 6.7916L15.34 10.6721L13.1933 11.0302Z" fill="#FFFFFF"></path>
                            </g>
                        </svg>
                    </button>
                </div>
            </div>
          </div>
        </div>

        <!-- Farklı Kaydet Modal -->
        <div id="saveAsModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4 hidden">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md relative">
                <h3 class="text-2xl font-bold mb-4 text-gray-800">Farklı Kaydet</h3>
                <button id="closeSaveAsModalBtn"
                    class="absolute top-4 right-4 text-gray-600 hover:text-gray-900 text-3xl font-bold"
                >
                    &times;
                </button>
                <div class="mb-4">
                    <label for="saveAsFileNameInput" class="block text-gray-700 text-sm font-bold mb-2">
                        Dosya Adı:
                    </label>
                    <input
                        type="text"
                        id="saveAsFileNameInput"
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        placeholder="dosya_adı.rpy"
                    />
                </div>
                <div class="flex justify-end gap-2">
                    <button id="confirmSaveAsBtn"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105"
                    >
                        Kaydet
                    </button>
                    <button id="cancelSaveAsBtn"
                        class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105"
                    >
                        İptal
                    </button>
                </div>
            </div>
        </div>

        <!-- Yeniden Adlandır Modal -->
        <div id="renameModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4 hidden">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md relative">
                <h3 class="text-2xl font-bold mb-4 text-gray-800">Yeniden Adlandır</h3>
                <button id="closeRenameModalBtn"
                    class="absolute top-4 right-4 text-gray-600 hover:text-gray-900 text-3xl font-bold"
                >
                    &times;
                </button>
                <div class="mb-4">
                    <label for="newFileNameInputModal" class="block text-gray-700 text-sm font-bold mb-2">
                        Yeni Ad:
                    </label>
                    <input
                        type="text"
                        id="newFileNameInputModal"
                        class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                        placeholder="yeni_dosya_adı.rpy"
                    />
                </div>
                <div class="flex justify-end gap-2">
                    <button id="confirmRenameBtn"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105"
                    >
                        Yeniden Adlandır
                    </button>
                    <button id="cancelRenameBtn"
                        class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-md shadow-300 transform hover:scale-105"
                    >
                        İptal
                    </button>
                </div>
            </div>
        </div>

        <!-- Onay Modalı (window.confirm yerine) -->
        <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4 hidden">
            <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md relative">
                <h3 class="text-2xl font-bold mb-4 text-gray-800" id="confirmationModalTitle">Onay</h3>
                <p class="mb-4 text-gray-700" id="confirmationModalMessage">Emin misiniz?</p>
                <div class="flex justify-end gap-2">
                    <button id="confirmActionBtn"
                        class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105"
                    >
                        Evet
                    </button>
                    <button id="cancelActionBtn"
                        class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 transform hover:scale-105"
                    >
                        İptal
                    </button>
                </div>
            </div>
        </div>

        <!-- Custom Notification Element -->
        <div id="customNotification" class="text-center"></div>

    </div>
    <!-- Hidden file input for import -->
    <input type="file" id="importFileInput" multiple class="hidden" accept=".rpy,.html,.txt,.mp3,.mp4,.jpg,.jpeg,.png,.gif,.json,.css,.js,.zip">

</body>
</html>
